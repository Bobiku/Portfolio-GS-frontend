<ng-container *ngIf="!isNotFound; else notFoundTemplate">
    <section class="container" id="projet-detail">
        <div class="content">
            <!-- Header section -->
            <div class="headerProjetDetail headingSection">
                <h1 class="noMargin">{{ projet?.title }}</h1>
                <p class="bodyLarge subtitle">{{ projet?.description }}</p>
                <div class="infoProject">
                    <div class="customer" *ngIf="projet?.customer">
                        <span class="bodyLarge label colorVariant">Client</span>
                        <span class="bodyLarge emphase">{{ projet?.customer }}</span>
                    </div>
                    <div class="role" *ngIf="projet?.roles">
                        <span class="bodyLarge label colorVariant">RÃ´le</span>
                        <span class="bodyLarge emphase">{{ projet?.roles?.join(', ') }}</span>
                    </div>
                    <div class="date" *ngIf="projet?.date">
                        <span class="bodyLarge label colorVariant">Date</span>
                        <span class="bodyLarge emphase">{{ projet?.date }}</span>
                    </div>
                    <div class="result" *ngIf="projet?.resultUrl">
                        <span class="bodyLarge label colorVariant">Livrable final</span>
                        <a href="{{ projet?.resultUrl }}" target="_blank" class="bodyLarge emphase">Voir le livrable <lucide-icon [img]="ExternalLink" [size]="20" class="iconLucide"></lucide-icon></a>
                    </div>
                </div>
            </div>
            <div class="banner" *ngIf="projet?.imageBannerUrl">
                <app-optimized-image 
                    [src]="getImageUrl(projet!.imageBannerUrl, '1280')"
                    [alt]="projet?.imageBannerAlt || 'Image du projet'"
                    class="banner-image"
                    [priority]="true"
                ></app-optimized-image>
            </div>
            <!-- Content section -->
            <div class="contentProjetDetail" *ngIf="this.blocks.length > 0; else loading">
                <ng-container *ngFor="let block of blocks; let i = index">
                    <ng-container [ngSwitch]="block.type">

                        <!-- Ouvrir une balise ul pour les bulleted_list_item -->
                        <ul *ngIf="block.type === 'bulleted_list_item' && (i === 0 || blocks[i - 1].type !== 'bulleted_list_item')" >
                            <li *ngFor="let item of block.content">
                                <ng-container *ngIf="isArray(block.content)">
                                    <app-formatted-text *ngFor="let segment of block.content" 
                                        [segment]="segment"
                                        [blockType]="block.type">
                                    </app-formatted-text>
                                </ng-container>
                            </li>
                        <!-- Fermer la balise ul/ol si le type change -->
                        <ng-container *ngIf="(i > 0 && blocks[i - 1].type !== block.type) || i === blocks.length - 1">
                            <ng-container *ngIf="blocks[i - 1].type === 'bulleted_list_item'">
                                </ul>
                            </ng-container>
                        </ng-container>

                        <!-- <ul *ngSwitchCase="'bulleted_list_item'">
                            <ng-container *ngIf="isArray(block.content)">
                                <li *ngFor="let item of isIterable(block.content) ? block.content : []">
                                    <ng-container *ngIf="isArray(item)">
                                        <app-formatted-text *ngFor="let segment of item" 
                                            [segment]="segment"
                                            [blockType]="block.type">
                                        </app-formatted-text>
                                    </ng-container>
                                </li>
                            </ng-container>
                        </ul>
                    
                        <ol *ngSwitchCase="'numbered_list_item'">
                            <ng-container *ngIf="isArray(block.content)">
                                <li *ngFor="let item of isIterable(block.content) ? block.content : []">
                                    <ng-container *ngIf="isArray(item)">
                                        <app-formatted-text *ngFor="let segment of item" 
                                            [segment]="segment"
                                            [blockType]="block.type">
                                        </app-formatted-text>
                                    </ng-container>
                                </li>
                            </ng-container>
                        </ol> -->

                        <div class="grid" *ngSwitchCase="'image'">
                            <ng-container *ngIf="isArray(block.content)">
                                <ng-container *ngFor="let item of isIterable(block.content) ? block.content : []">
                                    <ng-container *ngIf="isArray(item)">
                                        <!-- <app-optimized-image 
                                            *ngFor="let img of item"
                                            [src]="getImageUrl(img, '1280')"
                                            [alt]="'Image'"
                                            [priority]="false"
                                            class="banner zoom"
                                            (click)="openImage(item)"
                                        ></app-optimized-image> -->
                                    </ng-container>
                                    <ng-container *ngIf="!isArray(item)">
                                        <!-- <app-optimized-image 
                                            class="banner zoom"
                                            [src]="getImageUrl(img, '1280')"
                                            [alt]="'Image'"
                                            [priority]="false"
                                            (click)="openImage(item)"
                                        ></app-optimized-image> -->
                                    </ng-container>
                                </ng-container>
                            </ng-container>
                        </div>
                    
                        <p *ngSwitchCase="'paragraph'">
                            <ng-container *ngIf="isArray(block.content)">
                                <app-formatted-text *ngFor="let segment of block.content" 
                                    [segment]="segment"
                                    [blockType]="block.type">
                                </app-formatted-text>
                            </ng-container>
                        </p>
                        <h2 *ngSwitchCase="'heading_1'">
                            <ng-container *ngIf="isArray(block.content)">
                                <app-formatted-text *ngFor="let segment of block.content" [segment]="segment"></app-formatted-text>
                            </ng-container>
                        </h2>
                        <h3 *ngSwitchCase="'heading_2'">
                            <ng-container *ngIf="isArray(block.content)">
                                <app-formatted-text *ngFor="let segment of block.content" [segment]="segment"></app-formatted-text>
                            </ng-container>
                        </h3>
                        <h4 *ngSwitchCase="'heading_3'">
                            <ng-container *ngIf="isArray(block.content)">
                                <app-formatted-text *ngFor="let segment of block.content" [segment]="segment"></app-formatted-text>
                            </ng-container>
                        </h4>
                        <hr *ngSwitchCase="'divider'"/>
                        <blockquote *ngSwitchCase="'quote'">
                            <ng-container *ngIf="isArray(block.content)">
                                <app-formatted-text *ngFor="let segment of block.content" [segment]="segment"></app-formatted-text>
                            </ng-container>
                        </blockquote>
                        <pre *ngSwitchCase="'code'"><code>
                            <ng-container *ngIf="isArray(block.content)">
                                <app-formatted-text *ngFor="let segment of block.content" [segment]="segment"></app-formatted-text>
                            </ng-container> 
                        </code></pre>
                        <div *ngSwitchDefault>
                            Unsupported block type: {{ block.type }}
                        </div>
                  </ng-container>
                </ng-container>
            </div>
        </div>
    </section>
    <app-projet-others></app-projet-others>
    <app-top-scroll-button url="#projet-detail"><lucide-icon [img]="CircleChevronUp" [size]="32" id="topScrollButton" class="iconLucide"></lucide-icon></app-top-scroll-button>
    <app-lightbox></app-lightbox>

    <ng-template #loading>
        <p>Loading...</p>
    </ng-template>
</ng-container>

<ng-template #notFoundTemplate>
    <app-not-found></app-not-found>
</ng-template>
